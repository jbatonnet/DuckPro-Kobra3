var v=Object.defineProperty;var d=(i,a,e)=>a in i?v(i,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[a]=e;var n=(i,a,e)=>d(i,typeof a!="symbol"?a+"":a,e);import{m as u,C as f,f as o,j as p,R as h,k as g}from"./index-DFslUFkS.js";var C=Object.defineProperty,D=Object.getOwnPropertyDescriptor,l=(i,a,e,t)=>{for(var r=t>1?void 0:t?D(a,e):a,c=i.length-1,m;c>=0;c--)(m=i[c])&&(r=(t?m(a,e,r):m(r))||r);return t&&r&&C(a,e,r),r};let s=class extends u(f){constructor(){super(...arguments);n(this,"cameraVideo");n(this,"cameraNameMenuItems",[])}async startPlayback(){const e=await this.getUserMedia();this.cameraVideo.srcObject=e,this.$emit("playback"),this.$emit("update:camera-name",await this.getDeviceLabel())}stopPlayback(){try{const e=this.cameraVideo.srcObject;if(e)for(const t of e.getTracks())t.stop(),e.removeTrack(t)}catch(e){o.error("[Device Camera] failed to stop and remove all tracks",e)}this.cameraVideo.srcObject=null}async getUserMedia(){const e=this.getSelectedDeviceCamera();try{const t=["environment","user"].includes(e)?"facingMode":"deviceId";return await navigator.mediaDevices.getUserMedia({video:{[t]:e}})}catch(t){return o.error(`[Device Camera] failed to select device ${e}`,t),this.setSelectedDeviceCamera(null),await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})}}async enumerateDevices(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput")}catch(e){return o.error("[Device Camera] failed to enumerate devices",e),[]}}async getDeviceLabel(){var t;if(this.cameraNameMenuItems.length===0){const r=await this.enumerateDevices();this.cameraNameMenuItems=[{text:this.$tc("app.general.label.environment_facing"),value:"environment"},{text:this.$tc("app.general.label.user_facing"),value:"user"},...r.map(c=>({text:c.label,value:c.deviceId}))],this.$emit("update:camera-name-menu-items",this.cameraNameMenuItems)}const e=this.getSelectedDeviceCamera();return(t=this.cameraNameMenuItems.find(r=>r.value===e))==null?void 0:t.text}getSelectedDeviceCamera(){return localStorage.getItem("deviceCamera.selectedCamera")??"environment"}setSelectedDeviceCamera(e){e?localStorage.setItem("deviceCamera.selectedCamera",e):localStorage.removeItem("deviceCamera.selectedCamera")}menuItemClick(e){this.getSelectedDeviceCamera()!==e&&(this.setSelectedDeviceCamera(e),this.stopPlayback(),this.startPlayback())}};l([h("streamingElement")],s.prototype,"cameraVideo",2);s=l([p({})],s);var _=function(){var a=this,e=a._self._c;return a._self._setupProxy,e("video",{ref:"streamingElement",style:a.cameraStyle,attrs:{autoplay:"",muted:""},domProps:{muted:!0}})},y=[],b=g(s,_,y,!1,null,null);const x=b.exports;export{x as default};
